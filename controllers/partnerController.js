const { sendEmail } = require('../utils/email');

class PartnerController {
  getPartnerPage(req, res) {
    const pageData = {
      title: "–ü–∞—Ä—Ç–Ω–µ—Ä—Å–∫–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞ | –°—Ç–∏–ª—Å–æ—Ñ—Ç",
      currentPage: "partner",
      meta: {
        description: "–ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Ç–µ—Å—å –∫ –Ω–∞—à–µ–π –ø–∞—Ä—Ç–Ω–µ—Ä—Å–∫–æ–π –ø—Ä–æ–≥—Ä–∞–º–º–µ",
        keywords: "–ø–∞—Ä—Ç–Ω–µ—Ä—ã, –ø–∞—Ä—Ç–Ω–µ—Ä—Å–∫–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞, —Å–æ—Ç—Ä—É–¥–Ω–∏—á–µ—Å—Ç–≤–æ",
      },
      partnershipTypes: [
        {
          id: "reseller",
          name: "–ü–∞—Ä—Ç–Ω–µ—Ä-—Ä–µ—Å–µ–ª–ª–µ—Ä",
          description:
            "–ü—Ä–æ–¥–∞–∂–∞ –Ω–∞—à–∏—Ö –ø—Ä–æ–≥—Ä–∞–º–º–Ω—ã—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –ø–æ–¥ –≤–∞—à–∏–º –±—Ä–µ–Ω–¥–æ–º –∏–ª–∏ —Å–æ–≤–º–µ—Å—Ç–Ω–æ —Å –Ω–∞—à–∏–º",
          benefits: [
            "–î–æ 30% –æ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –ª–∏—Ü–µ–Ω–∑–∏–π",
            "–ì–æ—Ç–æ–≤—ã–µ —Ü–µ–Ω–æ–≤—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è",
            "–ú–∞—Ä–∫–µ—Ç–∏–Ω–≥–æ–≤–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞",
            "–û–±—É—á–µ–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞–º",
          ],
          image: "images/gtt/photo_5321395193787840892_x.jpg",
        },
        {
          id: "integrator",
          name: "–°–∏—Å—Ç–µ–º–Ω—ã–π –∏–Ω—Ç–µ–≥—Ä–∞—Ç–æ—Ä",
          description: "–í–Ω–µ–¥—Ä–µ–Ω–∏–µ –Ω–∞—à–∏—Ö —Ä–µ—à–µ–Ω–∏–π –≤ —Å–æ—Å—Ç–∞–≤–µ –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤",
          benefits: [
            "–î–æ 40% –æ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –ø—Ä–æ–µ–∫—Ç–∞",
            "–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞",
            "–°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤",
            "–£—á–∞—Å—Ç–∏–µ –≤ —Ç–µ–Ω–¥–µ—Ä–∞—Ö",
          ],
          image: "images/gtt/i.jpg",
        },
        {
          id: "developer",
          name: "–ü–∞—Ä—Ç–Ω–µ—Ä-—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫",
          description:
            "–°–æ–∑–¥–∞–Ω–∏–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –º–æ–¥—É–ª–µ–π –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π –¥–ª—è –Ω–∞—à–∏—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤",
          benefits: [
            "–î–æ 50% –æ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏",
            "–î–æ—Å—Ç—É–ø –∫ API –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏",
            "–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞",
            "–ü—Ä–æ–¥–≤–∏–∂–µ–Ω–∏–µ —Ä–µ—à–µ–Ω–∏–π",
          ],
          image: "images/gtt/programming-background-collage-2-1.jpg",
        },
      ],
    };

    res.render("pages/partner", pageData);
  }

  async submitPartnerApplication(req, res) {
    try {
      const { company, name, email, phone, type, message } = req.body;

      // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö
      if (!company || !name || !email || !phone || !type) {
        return res.status(400).json({
          success: false,
          message: "–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è",
        });
      }

      // –§–æ—Ä–º–∏—Ä—É–µ–º —Ç–µ–∫—Å—Ç –ø–∏—Å—å–º–∞
      const emailText = `
        üì© –ù–æ–≤–∞—è –∑–∞—è–≤–∫–∞ –Ω–∞ –ø–∞—Ä—Ç–Ω–µ—Ä—Å—Ç–≤–æ

        –ö–æ–º–ø–∞–Ω–∏—è: ${company}
        –ò–º—è: ${name}
        Email: ${email}
        –¢–µ–ª–µ—Ñ–æ–Ω: ${phone}
        –¢–∏–ø –ø–∞—Ä—Ç–Ω–µ—Ä–∞: ${type}
        
        –°–æ–æ–±—â–µ–Ω–∏–µ:
        ${message || "–ë–µ–∑ —Å–æ–æ–±—â–µ–Ω–∏—è"}
      `;

      // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø–∏—Å—å–º–æ
      await sendEmail(
        process.env.EMAIL_FROM,
        "–ù–æ–≤–∞—è –∑–∞—è–≤–∫–∞ –Ω–∞ –ø–∞—Ä—Ç–Ω–µ—Ä—Å—Ç–≤–æ",
        emailText
      );

      res.json({
        success: true,
        message:
          "–°–ø–∞—Å–∏–±–æ –∑–∞ –≤–∞—à—É –∑–∞—è–≤–∫—É! –ú—ã —Å–≤—è–∂–µ–º—Å—è —Å –≤–∞–º–∏ –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è.",
      });
    } catch (error) {
      console.error("–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞—è–≤–∫–∏:", error);
      res.status(500).json({
        success: false,
        message: "–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∑–∞—è–≤–∫–∏",
      });
    }
  }
}

module.exports = new PartnerController();
