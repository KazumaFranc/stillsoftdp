const { sendEmail } = require('../utils/email');

class DroneController {
  // –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞—è–≤–æ–∫ –Ω–∞ –±–µ—Å–ø–∏–ª–æ—Ç–Ω–∏–∫–∏
  getDronesPage(req, res) {
    const pageData = {
      title: '–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –ü–û –¥–ª—è –±–µ—Å–ø–∏–ª–æ—Ç–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ | –°—Ç–∏–ª—Å–æ—Ñ—Ç',
      currentPage: 'po-drones',
      meta: {
        description: '–°–æ–∑–¥–∞–µ–º –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–ª—è –¥—Ä–æ–Ω–æ–≤, —Ä–æ–±–æ—Ç–æ–≤ –∏ –∞–≤—Ç–æ–Ω–æ–º–Ω—ã—Ö —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω—ã—Ö —Å—Ä–µ–¥—Å—Ç–≤',
        keywords: '–±–µ—Å–ø–∏–ª–æ—Ç–Ω–∏–∫–∏, –¥—Ä–æ–Ω—ã, –ü–û –¥–ª—è –¥—Ä–æ–Ω–æ–≤, –∞–≤—Ç–æ–Ω–æ–º–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã'
      },
      droneTypes: [
        {
          id: "drones",
          name: "–ë–µ—Å–ø–∏–ª–æ—Ç–Ω—ã–µ –ª–µ—Ç–∞—Ç–µ–ª—å–Ω—ã–µ –∞–ø–ø–∞—Ä–∞—Ç—ã",
          description:
            "–û–ø–∏—Å–∞–Ω–∏–µ –¥—Ä–æ–Ω–æ–≤",
        },
        {
          id: "dirt-robot",
          name: "–ù–∞–∑–µ–º–Ω—ã–µ —Ä–æ–±–æ—Ç—ã",
          description: "–û–ø–∏—Å–∞–Ω–∏–µ –Ω–∞–∑–µ–º–Ω—ã—Ö —Ä–æ–±–æ—Ç–æ–≤",
        },
        {
          id: "sea-robot",
          name: "–ú–æ—Ä—Å–∫–∏–µ –¥—Ä–æ–Ω—ã",
          description:
            "–û–ø–∏—Å–∞–Ω–∏–µ –º–æ—Ä—Å–∫–∏—Ö –¥—Ä–æ–Ω–æ–≤",
        },
        {
          id: "lava-robot",
          name: "–õ–∞–≤–∞ –¥—Ä–æ–Ω—ã",
          description:
            "–û–ø–∏—Å–∞–Ω–∏–µ –º–æ—Ä—Å–∫–∏—Ö –¥—Ä–æ–Ω–æ–≤",
        },
        {
          id: "other",
          name: "–î—Ä—É–≥–æ–µ",
          description:
            "–û–ø–∏—Å–∞–Ω–∏–µ –¥—Ä—É–≥–æ–≥–æ",
        },
      ],
    };
    
    res.render('pages/po-drones', pageData);
  }


  async submitDroneApplication(req, res) {
    try {
      const { company, name, email, phone, type, message } = req.body;



      /*
      // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö
      if (!company || !name || !email || !phone || !type) {
        return res.status(400).json({
          success: false,
          message: "–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è",
        });
      }*/

      // –§–æ—Ä–º–∏—Ä—É–µ–º —Ç–µ–∫—Å—Ç –ø–∏—Å—å–º–∞
      const emailText = `
        üì© –ù–æ–≤–∞—è –∑–∞—è–≤–∫–∞ –Ω–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫—É

        –ö–æ–º–ø–∞–Ω–∏—è: ${company}
        –ò–º—è: ${name}
        Email: ${email}
        –¢–µ–ª–µ—Ñ–æ–Ω: ${phone}
        –¢–∏–ø –ø—Ä–æ–µ–∫—Ç–∞: ${type}
        
        –°–æ–æ–±—â–µ–Ω–∏–µ:
        ${message || "–ë–µ–∑ —Å–æ–æ–±—â–µ–Ω–∏—è"}
      `;

      // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø–∏—Å—å–º–æ
      await sendEmail(
        process.env.EMAIL_FROM,
        "–ù–æ–≤–∞—è –∑–∞—è–≤–∫–∞ –Ω–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫—É",
        emailText
      );

      res.json({
        success: true,
        message:
          "–°–ø–∞—Å–∏–±–æ –∑–∞ –≤–∞—à—É –∑–∞—è–≤–∫—É! –ú—ã —Å–≤—è–∂–µ–º—Å—è —Å –≤–∞–º–∏ –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è.",
      });
    } catch (error) {
      console.error("–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞—è–≤–∫–∏:", error);
      res.status(500).json({
        success: false,
        message: "–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∑–∞—è–≤–∫–∏",
      });
    }
  }
}

module.exports = new DroneController();
